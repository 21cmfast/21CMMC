# Config file for automatic testing at travis-ci.org
dist: xenial
language: python
python:
  - 3.7
  - 3.6

addons:
  apt:
    packages:
    - libfftw3-dev
    - libgsl0-dev
    - gfortran
    - libblas-dev
    - liblapack-dev
    update: true


# command to install dependencies, e.g. pip install -r requirements.txt --use-mirrors
install:
    - echo $TRAVIS_BUILD_DIR
    - pwd
    - pip install -U tox-travis coverage coveralls tox-pip-version Cython
    - git clone https://github.com/lesgourg/class_public.git class
    - cd class && PYTHON=`which python` make all && cd $TRAVIS_BUILD_DIR
    - curl "http://pla.esac.esa.int/pla/aio/product-action?COSMOLOGY.FILE_ID=COM_Likelihood_Data-baseline_R3.00.tar.gz" -o COM_Likelihood_Data-baseline_R3.00.tar.gz && tar zxvf COM_Likelihood_Data-baseline_R3.00.tar.gz
    - wget https://heasarc.gsfc.nasa.gov/FTP/software/fitsio/c/cfitsio_latest.tar.gz && tar zxvf cfitsio_latest.tar.gz
    - cd cfitsio* && ./configure --prefix=$TRAVIS_BUILD_DIR && make shared  && make install && cd $TRAVIS_BUILD_DIR
    - curl "http://pla.esac.esa.int/pla/aio/product-action?COSMOLOGY.FILE_ID=COM_Likelihood_Code-v3.0_R3.01.tar.gz" -o COM_Likelihood_Code-v3.0_R3.01.tar.gz && tar zxvf COM_Likelihood_Code-v3.0_R3.01.tar.gz 
    - cd code/plc_3.0/plc-3.01 && ./waf configure --prefix=$TRAVIS_BUILD_DIR --cfitsio_prefix=$TRAVIS_BUILD_DIR && ./waf install && cd $TRAVIS_BUILD_DIR/bin && source clik_profile.sh && cd $TRAVIS_BUILD_DIR

# command to run tests, e.g. python setup.py test
script:
  - tox
  - coverage report


# Calculate coverage
after_success:
  - ls -a
  - coveralls
